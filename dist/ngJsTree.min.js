!function(a){"use strict";function b(b){var c=1;this.nodes=b.treeData,this.nodesFingerprint=function(a){return a.__uiNodeId||(a.__uiNodeId=c++),""+a.__uiNodeId+(a.id||"")+(a.text||"")+(a.type||"")},this.changeWatcher=function(b,c){var d,e=function(){for(var d,e,f=a.isFunction(b)?b():b,h=[],i=0,j=f.length;j>i;i++)e=f[i],d=c(e),g[d]=e,h.push(d);return h},f=function(a,b){var c,d,e=[],f={};for(c=0,d=b.length;d>c;c++)f[b[c]]=!0;for(c=0,d=a.length;d>c;c++)f[a[c]]||e.push(a[c]);return e},g={},h=function(a,b){var e,h,i,j,k={},l=f(b,a);for(e=0,h=l.length;h>e;e++){var m=l[e];i=g[m],delete g[m];var n=c(i);n===m?d.onRemoved(i):(k[n]=m,d.onChanged(i))}var o=f(a,b);for(e=0,h=o.length;h>e;e++)j=o[e],i=g[j],k[j]||d.onAdded(i)};return d={subscribe:function(a,b){a.$watch(e,function(a,c){b&&b(a,c)===!1||h(a,c)},!0)},onAdded:a.noop,onChanged:a.noop,onRemoved:a.noop}}}function c(){return{restrict:"A",scope:{treeData:"=ngModel",shouldApply:"&"},controller:"jsTreeCtrl",link:function(b,c,d,e){function f(a,b,c){if(c.treeEvents)for(var d=c.treeEvents.split(";"),e=0;e<d.length;e++)if(d[e].length>0){var f=d[e].split(":")[0]+".jstree",g=d[e].split(":")[1];a.tree.on(f,a.$parent.$eval(g))}}function g(){var c=d.jsTree?b.$parent.$eval(d.jsTree):{};h={},a.copy(c,h);var e=JSON.stringify(h);return h.core?h.core.data=b.treeData:h.core={data:b.treeData},e}var h=null,i=e.changeWatcher(e.nodes,e.nodesFingerprint),j=!1;b.destroy=function(){b.tree=d.tree?b.$parent[d.tree]=c:c,b.tree.jstree("destroy")},b.init=function(){b.tree.jstree(h),f(b,c,d)},i.onChanged=function(a){b.tree.jstree(!0).set_type(a.id,a.type),b.tree.jstree(!0).rename_node(a.id,a.text)},i.onAdded=function(a){for(;j;);j=!0;var c=b.tree.jstree(!0).get_node(a.parent),d=b.tree.jstree(!0).create_node(c,a,"inside",function(){j=!1});d||(j=!1)},i.onRemoved=function(a){b.tree.jstree(!0).delete_node(a.id)},i.subscribe(b,function(){return b.shouldApply?b.shouldApply():!0}),b.$watch(g,function(){b.destroy(),b.init()})}}}b.$inject=["$scope"];var d=a.module("ngJsTree",[]);d.controller("jsTreeCtrl",b),d.directive("jsTree",c)}(angular);