"use strict";angular.module("ngJsTree",[]),angular.module("ngJsTree").controller("jsTreeCtrl",function(a){var b=1;this.nodes=a.treeData,this.nodesFingerprint=function(a){return a.__uiNodeId||(a.__uiNodeId=b++),""+a.__uiNodeId+(a.id||"")+(a.text||"")+(a.type||"")},this.changeWatcher=function(a,b){var c,d=function(){for(var c,d,e=angular.isFunction(a)?a():a,g=[],h=0,i=e.length;i>h;h++)d=e[h],c=b(d),f[c]=d,g.push(c);return g},e=function(a,b){var c,d,e=[],f={};for(c=0,d=b.length;d>c;c++)f[b[c]]=!0;for(c=0,d=a.length;d>c;c++)f[a[c]]||e.push(a[c]);return e},f={},g=function(a,d){var g,h,i,j,k={},l=e(d,a);for(g=0,h=l.length;h>g;g++){var m=l[g];i=f[m],delete f[m];var n=b(i);n===m?c.onRemoved(i):(k[n]=m,c.onChanged(i))}var o=e(a,d);for(g=0,h=o.length;h>g;g++)j=o[g],i=f[j],k[j]||c.onAdded(i)};return c={subscribe:function(a,b){a.$watch(d,function(a,c){b&&b(a,c)===!1||g(a,c)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}}}),angular.module("ngJsTree").directive("jsTree",function(a){return{restrict:"A",scope:{treeData:"=ngModel"},controller:"jsTreeCtrl",link:function(b,c,d,e){function f(a,b,c){if(c.treeEvents)for(var d=c.treeEvents.split(";"),e=0;e<d.length;e++)if(d[e].length>0){var f=d[e].split(":")[0]+".jstree",g=d[e].split(":")[1];a.tree.on(f,a.$parent[g])}}function g(){var a=d.jsTree?b.$parent.$eval(d.jsTree):{};h={},angular.copy(a,h);var c=JSON.stringify(h);return h.core?h.core.data=b.treeData:h.core={data:b.treeData},c}var h=null,i=e.changeWatcher(e.nodes,e.nodesFingerprint);b.destroy=function(){a.debug("jsTree: destroy called"),b.tree=d.tree?b.$parent[d.tree]=c:c,b.tree.jstree("destroy")},b.init=function(){a.debug("jsTree: init called"),b.tree.jstree(h),f(b,c,d)},i.onChanged=function(c){a.debug("jsTree: onChanged called"),b.tree.jstree(!0).set_type(c.id,c.type),b.tree.jstree(!0).rename_node(c.id,c.text)},i.onAdded=function(a){var c=b.tree.jstree(!0).get_node(a.parent);b.tree.jstree(!0).create_node(c,a,"inside",angular.noop,!1)},i.onRemoved=function(a){b.tree.jstree(!0).delete_node(a.id)},i.subscribe(b,function(){return!0}),b.$watch(g,function(){a.debug("jsTree: options changed, will recreate tree"),b.destroy(),b.init()})}}});